---
title: "p8105_hw2_nk2814"
author: "Naama Kipperman"
date: "9/26/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1
### Read and clean Mr. Trash Wheel data sheet

```{r}

# First, load necessary packages.

library(tidyverse)
library(readxl)
library(dplyr)

# Import excel file and name it 'p1_trash', specify sheet
# Omit non-data entries (rows with notes / figures; columns containing notes)
# Clean up variable names
# Omit rows where dumpster is missing
# Round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)

p1_trash=read_excel(path="./data/healthyharbor_updated.xlsx", sheet=1, col_names = TRUE, range=cell_cols("A:N")) %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster) %>% 
  mutate( 
      sports_balls =  as.integer(round(sports_balls, digits=0)))
 
```

### Read and clean precipitation data for 2017
```{r}

# Read in 2017 sheet
# Clean variable names
# Omit rows without precipitation data
# Add a variable year (2017)
p1_2017 = read_excel(path="./data/healthyharbor_updated.xlsx", sheet=6, col_names = TRUE, skip=1, range="A2:B14") %>% 
    janitor::clean_names() %>%
  rename(precipitation=total) %>% 
  drop_na(precipitation) %>% 
  mutate(
    year=2017
  )


```

### Read and clean precipitation data for 2018

```{r}

# Read in 2018 sheet
# Clean variable names
# Omit rows without precipitation data
# Add a variable year (2018)
p1_2018 = read_excel(path="./data/healthyharbor_updated.xlsx", sheet=5, col_names = TRUE, skip=1, range="A2:B14") %>% 
    janitor::clean_names() %>%
  rename(precipitation=total) %>% 
  drop_na(precipitation) %>% 
  mutate(
    year=2018
  )



```


### Combine precipitation datasets and convert month to a character variable

```{r}
p1_combined = 
  full_join(p1_2017, p1_2018) %>% 
  rename(
    month.name=month
  )

```

### Write a paragraph about this data.


The number of observations in the 2017 precipitation dataset is 
`r nrow(p1_2017)`. The number of observations in the 2018 precipitation dataset is `r nrow(p1_2018)`. The primary variables in the datasets were `r names(p1_2017)`. The total precipitation in 2018 was `r sum(pull(p1_2018,precipitation)) ` inches. The median number of sports balls in a dumpster in 2017 was `r filter(p1_trash, year == 2017) %>% pull(sports_balls) %>% median() ` balls.

## Problem 2

### First, clean the data in pols-month.csv

```{r}

# Import csv file, clean names, and separate 'mon' into 3 integer variables year, month, day
# Create a president variable taking values gop and dem, and remove prez_dem, prez_gop,day variable
# Arrange politicians dataset by year and month

politicians_data = read_csv(file = "./data/pols-month.csv") %>%
  janitor::clean_names() %>% 
  separate(mon, into=c("year", "month", "day"), sep="-") %>% 
  mutate( 
        year =  as.integer(year),
        month = as.numeric(month),
        month = month.abb[month],
        day = as.integer(day)) %>% 
  mutate(presidents = if_else(prez_gop >= 1, 'gop', 'dem')) %>%
  select(-prez_dem, -prez_gop, -day) %>% 
  arrange(year,month)


```

### Second, clean the data in snp.csv in similar manner

```{r}

# Import csv file, clean names, separate 'date' into 3 integer variables month, day, and year
# Remove variable 'day'
# Arrange snp dataset by year and month

snp_data = read_csv(file = "./data/snp.csv") %>%
  janitor::clean_names() %>% 
  separate(date, into=c("month", "day", "year"), sep="/") %>% 
  mutate( 
        month =  as.numeric(month),
        month = month.abb[month],
        day = as.integer(day),
        year = as.integer(year)) %>% 
  select(-day) %>% 
  arrange(year,month)

```

### Third, tidy the unemployment data so that it can be merged with the previous datasets

```{r}

# Import unemployment csv
# Tidy unemployment data such that there's a year, month, and unemployment rate column
# Change year and month to integers
# Arrange unemployment dataset by year and month

unemployment = read_csv(file = "./data/unemployment.csv")%>% 
  pivot_longer(
    Jan:Dec,
    names_to="month",
    values_to="unemployment") %>%
   janitor::clean_names() %>%
  mutate(
    year=as.integer(year)
    ) %>% 
   arrange(year, month)
  

```

#### Join the datasets by merging snp into pols, and merging unemployment into the result.

```{r}

p2_merged = 
  left_join(politicians_data, snp_data, by = c("year", "month")) %>% left_join(unemployment, by=c("year", "month"))

```

#### Write a short paragraph about your datasets. Explain briefly what each dataset contained, and describe the resulting dataset (e.g. give the dimension, range of years, and names of key variables).

The **politicians dataset** (politicians_data) contains data about the numerical breakdown of republicans/democrats in Congress for each month from `r min(pull(politicians_data, year))` to `r max(pull(politicians_data, year))`. 
There are `r nrow(politicians_data)` observations in this dataset, and `r ncol(politicians_data)` variables, named `r names(politicians_data)`. 
These variables capture the number of governors, senators, and representatives in each month who are republican and democrat, and which party the president belongs to for each given month. 

The **snp dataset** (snp_data) contains the closing values of the S&P stock index for every month from `r min(pull(snp_data, year))` to `r max(pull(snp_data, year))`. There are `r nrow(snp_data)` observations in this dataset, and `r ncol(snp_data)` variables, named `r names(snp_data)`. 

The **unemployment dataset** (unemployment) contains the US unemployment percentage of every month from `r min(pull(unemployment, year))` to `r max(pull(unemployment, year))`.  There are `r nrow(unemployment)` observations in this dataset, and `r ncol(unemployment)` variables, named `r names(unemployment)`. 

The **resulting combined dataset** contains the unemployment percentages, the closing S&P stock index, and political party breakdown of Congress/presidents for each month since 1947. However, it's important to note that this merged dataset only has **complete data** for each month  beginning in the year 1950, as this was the earliest year that the S&P data was available for. 

